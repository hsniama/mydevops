Paso 1 â€“ IaC con Terraform (infraestructura base)

Primero definimos todo lo que es infraestructura en Azure:

Resource Group.

ACR (Azure Container Registry) â†’ donde se subirÃ¡ tu imagen Docker.

AKS (Azure Kubernetes Service) â†’ cluster con 2 nodos mÃ­nimo.

AsignaciÃ³n de ACR a AKS (para que AKS pueda hacer pull de la imagen).

Resultado esperado: despuÃ©s de terraform apply, tienes un cluster AKS listo, un ACR y puedes hacer pull de imÃ¡genes privadas.

Nota: No subimos todavÃ­a la imagen ni aplicamos manifests de K8s, eso viene despuÃ©s.

Paso 2 â€“ Docker y build de la imagen

Ahora que ya existe el ACR, hacemos:

docker build de tu microservicio.

docker tag con la URL de tu ACR.

docker push a tu ACR.

Resultado esperado: tu imagen Docker ya estÃ¡ en ACR y lista para ser usada por AKS.

Paso 3 â€“ Manifests de Kubernetes

Una vez AKS y ACR estÃ¡n listos y la imagen existe:

Deployment â†’ apuntando a la imagen en ACR.

Service â†’ LoadBalancer para exponer tu microservicio.

Ingress â†’ HTTPS para el curl del evaluador.

Secrets â†’ API_KEY, SECRET_KEY y TLS.

Opcional: estos tambiÃ©n se pueden crear desde Terraform usando provider kubernetes, pero puedes aplicarlos manualmente la primera vez para pruebas.

Paso 4 â€“ Pipeline en Azure DevOps

Con la infraestructura y microservicio listos, hacemos el pipeline como cÃ³digo:

YAML pipeline que haga build y push Docker a ACR.

Que haga deploy en AKS usando kubectl apply de tus manifests.

Que tenga stages â€œbuildâ€ y â€œtestâ€ mÃ­nimo (como pide la prueba).

Integrar tests automÃ¡ticos de tu microservicio (ya los tienes).

Definir que el master branch deploya a producciÃ³n.

AquÃ­ ya aprovechas que Terraform tambiÃ©n puede ser parte del pipeline para que incluso AKS + ACR se creen automÃ¡ticamente si quieres.

Paso 5 â€“ ValidaciÃ³n final

Verificar que el endpoint /DevOps funcione en HTTPS.

Probar que la API_KEY y JWT funcionen correctamente.

Verificar que cada token JWT sea Ãºnico y que no se pueda reutilizar.

Revisar que los pods estÃ©n en mÃ­nimo 2 replicas, con readiness/liveness probe.

ğŸ”¹ Resumen del orden recomendado:

Terraform â†’ infra (RG, ACR, AKS).

Docker â†’ build y push a ACR.

Kubernetes manifests â†’ Deployment, Service, Ingress, Secrets.

Pipeline en Azure DevOps â†’ build, test, deploy.

ValidaciÃ³n final.